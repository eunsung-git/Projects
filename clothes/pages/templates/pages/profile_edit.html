<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <nav>
        {% if user.is_authenticated %}
            <a href="{% url 'pages:profile_detail' %}" style="background-color:yellow; font-size: 24px;">
                {{ user.username }} 님, 안녕하세요!
            </a>
            <!-- <span style="background-color:yellow; font-size: 24px;">{{ user.username }} 님, 안녕하세요!</span> -->
             <form action="{% url 'pages:logout' %}" method="POST">
                {% csrf_token %}
                <input type="submit" value='Logout'>
            </form>
        {% else %}
            <a href="{% url 'pages:login' %}">Login</a>
            <a href="{% url 'pages:signup' %}">Signup</a>
        {% endif %}
    </nav>

    <h1 align='center'>Profile Edit</h1>

    <fieldset style="width:330px; height: 250px;">
        <form action="" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            {{ form.as_p }}


            {{ profile_form.region }}
            <a id="region-search">Search</a>
            <ul id="region-result"></ul>
            
            <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
            <script>
                var regionInput = document.getElementById('id_region')
                var searchButton = document.getElementById('region-search')
                var regionResult = document.getElementById('region-result')

                searchButton.addEventListener('click', function () {
                    dong = regionInput.value

                    regionResult.innerHTML = '<li>Searching...</li>'
                    axios.get('/search_region/',  {
                                    params: {
                                        dong: dong
                                    }
                                })
                            .then(function (response) {
                                regions = response.data.jibuns.map(function (region) {
                                    return region.join(' ')
                                })
                                regionResult.innerHTML = ''
                                regions.forEach(function (region) {
                                    const li = document.createElement('li')
                                    li.classList.add('region-result-item')
                                    li.append(region)
                                    regionResult.append(li)
                                })

                                items = document.querySelectorAll('.region-result-item')
                                items.forEach(function (element) {
                                    element.addEventListener('click', function (e) {
                                            regionInput.value = e.target.innerText
                                            regionResult.innerHTML = ''
                                        })
                                    })
                            })
                })
            </script><br><br>


            {{ profile_form.gender }}<br><br>
           
            <input type="submit" value="Update" style="width:80px; height: 40px; font-size: 18px;">
        </form>
    </fieldset>
</body>
</html>
